<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="eJedzie.pl" />
    <meta name="theme-color" content="#3b82f6" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <title>Czy ulica stoi? - SpoÅ‚ecznoÅ›ciowe raporty ruchu</title>
    <meta name="description" content="SprawdÅº aktualny stan ruchu na ulicach w Twojej okolicy. SpoÅ‚ecznoÅ›ciowa aplikacja do raportowania korkÃ³w i pÅ‚ynnoÅ›ci ruchu." />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="Czy ulica stoi? - Raporty ruchu" />
    <meta property="og:description" content="SpoÅ‚ecznoÅ›ciowa aplikacja do sprawdzania stanu ruchu na ulicach" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-H86458DTN6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-H86458DTN6');
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2442601232836054"
     crossorigin="anonymous"></script>
    
    <!-- OneSignal SDK -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        console.log('[OneSignal-Init] Starting initialization...');

        await OneSignal.init({
          appId: "16ce973c-c7b3-42ff-b7b4-fe48be517186",
          serviceWorkerParam: { scope: '/' },
          serviceWorkerPath: '/OneSignalSDKWorker.js',
          // Allow notifications to display even when page is in focus
          notifyButton: {
            enable: false
          },
          // Show notifications even when page is focused (foreground)
          allowLocalhostAsSecureOrigin: true,
        });

        console.log('[OneSignal-Init] Init complete, setting up event listeners...');

        // Add listener for when notification will display in foreground
        OneSignal.Notifications.addEventListener('foregroundWillDisplay', (event) => {
          console.log('ðŸ”” [OneSignal-Notification] foregroundWillDisplay event triggered!');
          console.log('[OneSignal-Notification] Event object:', event);
          console.log('[OneSignal-Notification] Notification data:', {
            title: event.notification?.title,
            body: event.notification?.body,
            data: event.notification?.data,
            icon: event.notification?.icon
          });

          // Prevent default to manually control display
          event.preventDefault();

          // Manually display the notification
          console.log('[OneSignal-Notification] Calling event.notification.display()...');
          event.notification.display();
          console.log('âœ… [OneSignal-Notification] Display called successfully');
        });

        // Add listener for when notification is displayed
        OneSignal.Notifications.addEventListener('displayed', (event) => {
          console.log('âœ… [OneSignal-Notification] Notification DISPLAYED event!');
          console.log('[OneSignal-Notification] Displayed notification:', event);
        });

        // Add listener for when notification is clicked
        OneSignal.Notifications.addEventListener('click', (event) => {
          console.log('ðŸ‘† [OneSignal-Notification] Notification CLICKED!');
          console.log('[OneSignal-Notification] Click event:', event);
        });

        // Add listener for when notification is dismissed
        OneSignal.Notifications.addEventListener('dismiss', (event) => {
          console.log('âŒ [OneSignal-Notification] Notification DISMISSED');
          console.log('[OneSignal-Notification] Dismiss event:', event);
        });

        // Add listener for permission changes
        OneSignal.Notifications.addEventListener('permissionChange', (event) => {
          console.log('ðŸ” [OneSignal-Permission] Permission changed!');
          console.log('[OneSignal-Permission] New permission:', event);
        });

        // Log subscription changes for debugging
        OneSignal.User.PushSubscription.addEventListener('change', (event) => {
          console.log('ðŸ”„ [OneSignal-Subscription] Subscription changed:', {
            previous: event.previous,
            current: event.current,
            optedIn: event.current.optedIn,
            id: event.current.id,
            token: event.current.token
          });
        });

        // Log current subscription status
        const currentStatus = {
          permission: OneSignal.Notifications.permissionNative,
          optedIn: OneSignal.User.PushSubscription.optedIn,
          id: OneSignal.User.PushSubscription.id,
          isPushSupported: OneSignal.Notifications.isPushSupported()
        };
        console.log('[OneSignal-Init] Current status:', currentStatus);

        console.log('âœ… [OneSignal-Init] Initialized successfully with all event listeners');
      });
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
