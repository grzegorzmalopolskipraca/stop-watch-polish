# Architecture Diagrams

Visual representations of the "Czy ulica stoi?" application architecture.

---

## 1. System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT (Browser)                          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  React 18 App (TypeScript + Vite)                       â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚    â”‚
â”‚  â”‚  â”‚  Pages   â”‚  â”‚Componentsâ”‚  â”‚  Utils   â”‚             â”‚    â”‚
â”‚  â”‚  â”‚ Index.tsxâ”‚  â”‚TrafficLineâ”‚ â”‚traffic-  â”‚             â”‚    â”‚
â”‚  â”‚  â”‚ Push.tsx â”‚  â”‚Predicted- â”‚ â”‚Calcula-  â”‚             â”‚    â”‚
â”‚  â”‚  â”‚ Stats.tsxâ”‚  â”‚  Traffic  â”‚ â”‚  tions   â”‚             â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  State Management:                                      â”‚    â”‚
â”‚  â”‚  â€¢ React Query (server state)                          â”‚    â”‚
â”‚  â”‚  â€¢ useState (local state)                              â”‚    â”‚
â”‚  â”‚  â€¢ localStorage (persistence)                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  OneSignal Web SDK v16                                   â”‚    â”‚
â”‚  â”‚  â€¢ Service Worker: /OneSignalSDKWorker.js               â”‚    â”‚
â”‚  â”‚  â€¢ Tag-based subscriptions: street_<name>               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUPABASE PLATFORM                            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  PostgreSQL Database â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¤   Edge Functions     â”‚       â”‚
â”‚  â”‚                      â”‚        â”‚   (Deno runtime)     â”‚       â”‚
â”‚  â”‚  Tables:             â”‚        â”‚                      â”‚       â”‚
â”‚  â”‚  â€¢ traffic_reports   â”‚        â”‚  â€¢ submit-traffic-   â”‚       â”‚
â”‚  â”‚  â€¢ coupons           â”‚        â”‚    report            â”‚       â”‚
â”‚  â”‚  â€¢ locations         â”‚        â”‚  â€¢ get-traffic-data  â”‚       â”‚
â”‚  â”‚  â€¢ chat_messages     â”‚        â”‚  â€¢ send-push-        â”‚       â”‚
â”‚  â”‚  â€¢ users             â”‚        â”‚    notifications     â”‚       â”‚
â”‚  â”‚  â€¢ ...               â”‚        â”‚  â€¢ ...               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                            â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚                      â”‚
â”‚  â”‚  Supabase Auth       â”‚                â”‚                      â”‚
â”‚  â”‚  â€¢ Email/Password    â”‚                â”‚                      â”‚
â”‚  â”‚  â€¢ OAuth providers   â”‚                â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚                      â”‚
â”‚                                            â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚                      â”‚
â”‚  â”‚  Supabase Storage    â”‚                â”‚                      â”‚
â”‚  â”‚  â€¢ Coupon images     â”‚                â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚                   â”‚
                    â–¼                       â–¼                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Google Routes   â”‚   â”‚  OneSignal API   â”‚  â”‚  Weather API â”‚
          â”‚       API        â”‚   â”‚                  â”‚  â”‚              â”‚
          â”‚  â€¢ Traffic data  â”‚   â”‚  â€¢ Push delivery â”‚  â”‚  â€¢ Forecasts â”‚
          â”‚  â€¢ Speed/durationâ”‚   â”‚  â€¢ Tag managementâ”‚  â”‚              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Data Flow - Traffic Report Submission

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 1. Clicks "Stoi" button
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Index.tsx                           â”‚
â”‚                                      â”‚
â”‚  â€¢ submitReport('stoi')              â”‚
â”‚  â€¢ Includes: street, direction,      â”‚
â”‚    speed (from TrafficLine)          â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 2. POST request
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edge Function:                      â”‚
â”‚  submit-traffic-report               â”‚
â”‚                                      â”‚
â”‚  â€¢ Validate input                    â”‚
â”‚  â€¢ Generate user_fingerprint         â”‚
â”‚  â€¢ Prepare INSERT query              â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 3. INSERT
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL Database                 â”‚
â”‚  traffic_reports table               â”‚
â”‚                                      â”‚
â”‚  Columns:                            â”‚
â”‚  â€¢ id (UUID)                         â”‚
â”‚  â€¢ street                            â”‚
â”‚  â€¢ status ('stoi')                   â”‚
â”‚  â€¢ direction                         â”‚
â”‚  â€¢ speed (km/h)                      â”‚
â”‚  â€¢ reported_at (timestamp)           â”‚
â”‚  â€¢ user_fingerprint                  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 4. Success response
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Query                         â”‚
â”‚  â€¢ Invalidate cache                  â”‚
â”‚  â€¢ Refetch traffic data              â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 5. UI updates
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Components re-render                â”‚
â”‚  â€¢ TrafficLine                       â”‚
â”‚  â€¢ PredictedTraffic                  â”‚
â”‚  â€¢ WeeklyTimeline                    â”‚
â”‚  â€¢ TodayTimeline                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 6. (Parallel) Trigger notification
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edge Function:                      â”‚
â”‚  send-push-notifications             â”‚
â”‚                                      â”‚
â”‚  â€¢ Query subscribers with tag        â”‚
â”‚    "street_borowska"                 â”‚
â”‚  â€¢ Send to OneSignal API             â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 7. Push delivery
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OneSignal API                       â”‚
â”‚  â€¢ Delivers push to devices          â”‚
â”‚  â€¢ Respects user preferences         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 8. Push received
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Other users' browsers               â”‚
â”‚  â€¢ Service worker receives push      â”‚
â”‚  â€¢ Shows notification                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Traffic Prediction Algorithm Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User requests prediction                              â”‚
â”‚  â€¢ Street: "Borowska"                                  â”‚
â”‚  â€¢ Direction: "do centrum"                             â”‚
â”‚  â€¢ Time: Current time                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Fetch Historical Data                        â”‚
â”‚  Query: last 28 days (4 weeks)                        â”‚
â”‚                                                        â”‚
â”‚  SELECT * FROM traffic_reports                        â”‚
â”‚  WHERE street = 'Borowska'                            â”‚
â”‚    AND direction = 'do centrum'                       â”‚
â”‚    AND reported_at >= NOW() - INTERVAL '28 days'      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Filter by Day of Week                        â”‚
â”‚                                                        â”‚
â”‚  Current day: Thursday (4)                            â”‚
â”‚  Filter only reports from other Thursdays             â”‚
â”‚                                                        â”‚
â”‚  Result: ~4 weeks Ã— 1 day = 4 days of data           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Group into Time Intervals                    â”‚
â”‚                                                        â”‚
â”‚  For PredictedTraffic: 5-minute intervals             â”‚
â”‚  â€¢ 10:00-10:05                                        â”‚
â”‚  â€¢ 10:05-10:10                                        â”‚
â”‚  â€¢ 10:10-10:15                                        â”‚
â”‚  â€¢ ... (12 intervals per hour)                       â”‚
â”‚                                                        â”‚
â”‚  For WeeklyTimeline: 30-minute blocks                â”‚
â”‚  â€¢ 05:00-05:30                                        â”‚
â”‚  â€¢ 05:30-06:00                                        â”‚
â”‚  â€¢ ... (34 blocks: 5:00-22:00)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Majority Voting per Interval                â”‚
â”‚                                                        â”‚
â”‚  Example interval: 10:00-10:05                        â”‚
â”‚                                                        â”‚
â”‚  Reports in interval:                                 â”‚
â”‚  â€¢ 10:02 - "stoi"                                     â”‚
â”‚  â€¢ 10:03 - "stoi"                                     â”‚
â”‚  â€¢ 10:04 - "toczy_sie"                               â”‚
â”‚                                                        â”‚
â”‚  Count:                                               â”‚
â”‚  â€¢ stoi: 2                                            â”‚
â”‚  â€¢ toczy_sie: 1                                       â”‚
â”‚                                                        â”‚
â”‚  Winner: "stoi" (majority)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: Generate Prediction                          â”‚
â”‚                                                        â”‚
â”‚  {                                                     â”‚
â”‚    time: "10:00",                                     â”‚
â”‚    status: "stoi",                                    â”‚
â”‚    confidence: 0.67  // 2 out of 3                   â”‚
â”‚  }                                                     â”‚
â”‚                                                        â”‚
â”‚  If no reports in interval â†’ status: "neutral"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: Render Visualization                         â”‚
â”‚                                                        â”‚
â”‚  PredictedTraffic component:                          â”‚
â”‚  â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”              â”‚
â”‚  â”‚ğŸŸ¢â”‚ğŸŸ¡â”‚ğŸ”´â”‚ğŸ”´â”‚ğŸ”´â”‚ğŸŸ¡â”‚ğŸŸ¢â”‚ğŸŸ¢â”‚ğŸŸ¡â”‚ğŸ”´â”‚ğŸŸ¢â”‚âšªâ”‚              â”‚
â”‚  â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜              â”‚
â”‚  10:00 â†’                         â†’ 11:00              â”‚
â”‚                                                        â”‚
â”‚  Colors:                                              â”‚
â”‚  ğŸŸ¢ jedzie  ğŸŸ¡ toczy_sie  ğŸ”´ stoi  âšª neutral         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Push Notification Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INITIALIZATION (index.html)                                 â”‚
â”‚                                                              â”‚
â”‚  OneSignal.init({                                           â”‚
â”‚    appId: "...",                                            â”‚
â”‚    notifyButton: { enable: false },                        â”‚
â”‚    serviceWorkerParam: {                                   â”‚
â”‚      scope: '/'                                            â”‚
â”‚    }                                                        â”‚
â”‚  })                                                         â”‚
â”‚                                                              â”‚
â”‚  â€¢ Loads SDK from CDN                                       â”‚
â”‚  â€¢ Registers service worker                                â”‚
â”‚  â€¢ Requests notification permission                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER SUBSCRIPTION FLOW                                      â”‚
â”‚                                                              â”‚
â”‚  1. User navigates to /push page                            â”‚
â”‚  2. Clicks "Subskrybuj Borowska"                           â”‚
â”‚  3. Push.tsx calls:                                         â”‚
â”‚     await OneSignal.User.addTag("street_borowska", "1")    â”‚
â”‚  4. Tag stored in OneSignal backend                        â”‚
â”‚  5. localStorage: subscriptions["Borowska"] = true         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NOTIFICATION TRIGGER                                        â”‚
â”‚                                                              â”‚
â”‚  When traffic report submitted for "Borowska":              â”‚
â”‚                                                              â”‚
â”‚  Edge Function: send-push-notifications                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 1. Construct message:                            â”‚      â”‚
â”‚  â”‚    title: "Ruch na Borowskiej"                   â”‚      â”‚
â”‚  â”‚    message: "Status: Stoi (do centrum)"          â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚ 2. Target filters:                               â”‚      â”‚
â”‚  â”‚    [                                             â”‚      â”‚
â”‚  â”‚      {                                           â”‚      â”‚
â”‚  â”‚        field: "tag",                             â”‚      â”‚
â”‚  â”‚        key: "street_borowska",                   â”‚      â”‚
â”‚  â”‚        relation: "=",                            â”‚      â”‚
â”‚  â”‚        value: "1"                                â”‚      â”‚
â”‚  â”‚      }                                           â”‚      â”‚
â”‚  â”‚    ]                                             â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚ 3. POST to OneSignal REST API                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ONESIGNAL PLATFORM                                          â”‚
â”‚                                                              â”‚
â”‚  â€¢ Receives notification request                            â”‚
â”‚  â€¢ Queries all devices with tag "street_borowska"          â”‚
â”‚  â€¢ Sends push via:                                          â”‚
â”‚    - Firebase Cloud Messaging (Android Chrome)             â”‚
â”‚    - Apple Push Notification Service (iOS Safari)          â”‚
â”‚    - Web Push Protocol (Desktop browsers)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER'S DEVICE                                               â”‚
â”‚                                                              â”‚
â”‚  Option A: App in foreground                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Custom foreground handler (index.html:63)      â”‚         â”‚
â”‚  â”‚ â€¢ Shows sonner toast notification              â”‚         â”‚
â”‚  â”‚ â€¢ Displays even when page is open              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                              â”‚
â”‚  Option B: App in background or closed                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Service Worker: /OneSignalSDKWorker.js         â”‚         â”‚
â”‚  â”‚ â€¢ Receives push event                          â”‚         â”‚
â”‚  â”‚ â€¢ Shows native browser notification            â”‚         â”‚
â”‚  â”‚ â€¢ Click â†’ opens app                            â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Component Hierarchy

```
App.tsx (Router)
â”‚
â”œâ”€â”€ Index.tsx (Main page)
â”‚   â”‚
â”‚   â”œâ”€â”€ Header (sticky)
â”‚   â”‚   â”œâ”€â”€ Street selector (dropdown)
â”‚   â”‚   â””â”€â”€ Direction filter (tabs)
â”‚   â”‚
â”‚   â”œâ”€â”€ TrafficLine
â”‚   â”‚   â”œâ”€â”€ Google Routes API integration
â”‚   â”‚   â”œâ”€â”€ Speed gauge display
â”‚   â”‚   â””â”€â”€ Speed update callback â†’ parent
â”‚   â”‚
â”‚   â”œâ”€â”€ Traffic status buttons
â”‚   â”‚   â”œâ”€â”€ "Stoi" button
â”‚   â”‚   â”œâ”€â”€ "Toczy siÄ™" button
â”‚   â”‚   â””â”€â”€ "Jedzie" button
â”‚   â”‚
â”‚   â”œâ”€â”€ PredictedTraffic
â”‚   â”‚   â”œâ”€â”€ Next 60 minutes (5-min intervals)
â”‚   â”‚   â””â”€â”€ Color-coded blocks
â”‚   â”‚
â”‚   â”œâ”€â”€ TodayTimeline
â”‚   â”‚   â”œâ”€â”€ Full 24 hours (1-hour blocks)
â”‚   â”‚   â””â”€â”€ Hourly traffic pattern
â”‚   â”‚
â”‚   â”œâ”€â”€ WeeklyTimeline
â”‚   â”‚   â”œâ”€â”€ Last 7 days (30-min blocks)
â”‚   â”‚   â”œâ”€â”€ Time: 5:00-22:00
â”‚   â”‚   â””â”€â”€ Day-of-week labels
â”‚   â”‚
â”‚   â”œâ”€â”€ GreenWave
â”‚   â”‚   â”œâ”€â”€ Optimal departure time calculator
â”‚   â”‚   â””â”€â”€ 10-minute interval analysis
â”‚   â”‚
â”‚   â”œâ”€â”€ WeatherForecast
â”‚   â”‚   â””â”€â”€ Current + 7-day forecast
â”‚   â”‚
â”‚   â”œâ”€â”€ StreetChat
â”‚   â”‚   â”œâ”€â”€ Message list
â”‚   â”‚   â”œâ”€â”€ Message input (with rate limiting)
â”‚   â”‚   â””â”€â”€ Real-time updates
â”‚   â”‚
â”‚   â”œâ”€â”€ CityVoting
â”‚   â”‚   â””â”€â”€ Street voting system
â”‚   â”‚
â”‚   â”œâ”€â”€ CarpoolingVoting
â”‚   â”‚   â””â”€â”€ Carpooling coordination
â”‚   â”‚
â”‚   â””â”€â”€ Bottom Navigation Menu
â”‚       â”œâ”€â”€ Link to #stan-ruchu
â”‚       â”œâ”€â”€ Link to #zglos
â”‚       â”œâ”€â”€ Link to #na-rowerze
â”‚       â””â”€â”€ Link to #cb-radio
â”‚
â”œâ”€â”€ Push.tsx (Notification management)
â”‚   â”œâ”€â”€ Subscription status check
â”‚   â”œâ”€â”€ Per-street subscription buttons
â”‚   â”œâ”€â”€ Tag management (add/remove)
â”‚   â””â”€â”€ Debug tools (full status check)
â”‚
â”œâ”€â”€ Statystyki.tsx (Statistics)
â”‚   â”œâ”€â”€ Traffic charts (recharts)
â”‚   â”œâ”€â”€ Aggregated data visualization
â”‚   â””â”€â”€ Historical trends
â”‚
â”œâ”€â”€ Coupons.tsx (Admin - Coupon management)
â”‚   â”œâ”€â”€ Coupon list
â”‚   â”œâ”€â”€ Create new coupon
â”‚   â”œâ”€â”€ Upload coupon image
â”‚   â””â”€â”€ Status management
â”‚
â”œâ”€â”€ Kupon.tsx (Coupon redemption)
â”‚   â”œâ”€â”€ QR code scanner (video feed)
â”‚   â”‚   â”œâ”€â”€ BrowserQRCodeReader (@zxing/browser)
â”‚   â”‚   â”œâ”€â”€ Camera permission request
â”‚   â”‚   â””â”€â”€ Scan result handler
â”‚   â”œâ”€â”€ Coupon details display
â”‚   â”œâ”€â”€ Redemption button
â”‚   â””â”€â”€ Status update
â”‚
â”œâ”€â”€ Konto.tsx (User account)
â”‚   â”œâ”€â”€ Profile information
â”‚   â”œâ”€â”€ Settings
â”‚   â””â”€â”€ Preferences
â”‚
â”œâ”€â”€ Auth.tsx (Authentication)
â”‚   â”œâ”€â”€ Login form
â”‚   â”œâ”€â”€ Signup form
â”‚   â””â”€â”€ Supabase Auth integration
â”‚
â”œâ”€â”€ About.tsx (/o-projekcie)
â”œâ”€â”€ Contact.tsx (/kontakt)
â”œâ”€â”€ TermsAndPrivacy.tsx (/regulamin)
â”œâ”€â”€ Rss.tsx (/rss)
â”‚   â””â”€â”€ RSS feed aggregator (RssTicker)
â”‚
â””â”€â”€ NotFound.tsx (404 page)
```

---

## 6. Database Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users              â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)                 â”‚
â”‚ email                   â”‚
â”‚ created_at              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 1:N
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  traffic_reports        â”‚         â”‚     locations           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)                 â”‚         â”‚ id (PK)                 â”‚
â”‚ street                  â”‚         â”‚ name                    â”‚
â”‚ status                  â”‚         â”‚ street                  â”‚
â”‚ direction               â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ speed                   â”‚                 â”‚
â”‚ reported_at             â”‚                 â”‚ 1:N
â”‚ user_fingerprint        â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚     coupons             â”‚
                                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                                    â”‚ id (PK)                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ local_id (FK)           â”‚
â”‚   chat_messages         â”‚         â”‚ local_name              â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚ discount                â”‚
â”‚ id (PK)                 â”‚         â”‚ status                  â”‚
â”‚ street                  â”‚         â”‚ time_from               â”‚
â”‚ message                 â”‚         â”‚ time_to                 â”‚
â”‚ user_fingerprint        â”‚         â”‚ image_link              â”‚
â”‚ created_at              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  incident_reports       â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)                 â”‚
â”‚ street                  â”‚
â”‚ incident_type           â”‚
â”‚ description             â”‚
â”‚ created_at              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   street_votes          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)                 â”‚
â”‚ street                  â”‚
â”‚ vote_type               â”‚
â”‚ user_fingerprint        â”‚
â”‚ created_at              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  carpooling_votes       â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)                 â”‚
â”‚ street                  â”‚
â”‚ direction               â”‚
â”‚ vote_type               â”‚
â”‚ user_fingerprint        â”‚
â”‚ created_at              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Relationships:**
- `users` 1:N `traffic_reports` (via user_fingerprint)
- `locations` 1:N `coupons` (via local_id)
- All tables use UUID primary keys
- `reported_at` and `created_at` use timestamptz (UTC)

---

## 7. State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STATE LAYERS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. SERVER STATE (React Query)                      â”‚   â”‚
â”‚  â”‚  â€¢ Traffic reports                                  â”‚   â”‚
â”‚  â”‚  â€¢ Chat messages                                    â”‚   â”‚
â”‚  â”‚  â€¢ Weather data                                     â”‚   â”‚
â”‚  â”‚  â€¢ User profile                                     â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  Cache: 5 minutes (staleTime)                      â”‚   â”‚
â”‚  â”‚  Refetch: on window focus, network reconnect       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. URL STATE (React Router)                        â”‚   â”‚
â”‚  â”‚  â€¢ Current page (/push, /statystyki)               â”‚   â”‚
â”‚  â”‚  â€¢ Query params (?id=coupon-123)                   â”‚   â”‚
â”‚  â”‚  â€¢ Hash fragments (#stan-ruchu)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. LOCAL STATE (useState)                          â”‚   â”‚
â”‚  â”‚  â€¢ Form inputs                                      â”‚   â”‚
â”‚  â”‚  â€¢ Modal open/closed                                â”‚   â”‚
â”‚  â”‚  â€¢ Loading states                                   â”‚   â”‚
â”‚  â”‚  â€¢ Error messages                                   â”‚   â”‚
â”‚  â”‚  â€¢ UI toggles (direction filter)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4. PERSISTENT STATE (localStorage)                 â”‚   â”‚
â”‚  â”‚  â€¢ selectedStreet: "Borowska"                       â”‚   â”‚
â”‚  â”‚  â€¢ subscriptions: { "Borowska": true, ... }        â”‚   â”‚
â”‚  â”‚  â€¢ userPreferences: { ... }                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DECISION TREE: Where to put state?

Is it from server?
â”œâ”€ Yes â†’ React Query (server state)
â””â”€ No
   â”œâ”€ Does it need to survive page reload?
   â”‚  â”œâ”€ Yes â†’ localStorage (persistent)
   â”‚  â””â”€ No
   â”‚     â”œâ”€ Should it be in URL (shareable)?
   â”‚     â”‚  â”œâ”€ Yes â†’ React Router (URL state)
   â”‚     â”‚  â””â”€ No â†’ useState (local state)
```

---

## 8. Testing Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TESTING PYRAMID                          â”‚
â”‚                                                             â”‚
â”‚                        /\                                   â”‚
â”‚                       /  \                                  â”‚
â”‚                      / E2E\    5% - Critical user flows    â”‚
â”‚                     /â”€â”€â”€â”€â”€â”€\   (Playwright)                â”‚
â”‚                    /        \                              â”‚
â”‚                   /Integration\  15% - API + Components   â”‚
â”‚                  /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\ (Vitest + MSW)            â”‚
â”‚                 /                \                         â”‚
â”‚                /   Unit Tests     \ 80% - Pure functions   â”‚
â”‚               /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\ (Vitest)             â”‚
â”‚              /                       \                     â”‚
â”‚             /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UNIT TESTS (Vitest)                                        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Target: 90%+ coverage                                      â”‚
â”‚                                                             â”‚
â”‚  âœ… Pure functions:                                         â”‚
â”‚     â€¢ trafficCalculations.ts                               â”‚
â”‚     â€¢ trafficPrediction.ts                                 â”‚
â”‚     â€¢ Speed calculations                                   â”‚
â”‚     â€¢ Time interval grouping                               â”‚
â”‚     â€¢ Majority voting algorithm                            â”‚
â”‚                                                             â”‚
â”‚  âœ… React components:                                       â”‚
â”‚     â€¢ Legend.tsx                                           â”‚
â”‚     â€¢ UI components (Button, Card, etc.)                  â”‚
â”‚     â€¢ Simple presentational components                     â”‚
â”‚                                                             â”‚
â”‚  âœ… Custom hooks:                                           â”‚
â”‚     â€¢ useTrafficReports                                    â”‚
â”‚     â€¢ useSubscriptionStatus                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INTEGRATION TESTS (Vitest + React Testing Library + MSW)  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Target: 70%+ coverage                                      â”‚
â”‚                                                             â”‚
â”‚  âœ… Components with data fetching:                         â”‚
â”‚     â€¢ TrafficLine + Google API (mocked)                   â”‚
â”‚     â€¢ PredictedTraffic + React Query                      â”‚
â”‚     â€¢ WeatherForecast + Weather API                       â”‚
â”‚                                                             â”‚
â”‚  âœ… Form submissions:                                       â”‚
â”‚     â€¢ Traffic report submission                            â”‚
â”‚     â€¢ Chat message submission                              â”‚
â”‚     â€¢ User authentication flow                             â”‚
â”‚                                                             â”‚
â”‚  âœ… Edge Functions (with test database):                   â”‚
â”‚     â€¢ submit-traffic-report                                â”‚
â”‚     â€¢ send-push-notifications                              â”‚
â”‚     â€¢ submit-chat-message                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  E2E TESTS (Playwright)                                     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Target: Critical paths only                                â”‚
â”‚                                                             â”‚
â”‚  âœ… Core user journeys:                                     â”‚
â”‚     1. Submit traffic report                               â”‚
â”‚        â€¢ Select street                                     â”‚
â”‚        â€¢ Choose direction                                  â”‚
â”‚        â€¢ Click status button                               â”‚
â”‚        â€¢ Verify success message                            â”‚
â”‚                                                             â”‚
â”‚     2. Subscribe to push notifications                     â”‚
â”‚        â€¢ Navigate to /push                                 â”‚
â”‚        â€¢ Click subscribe button                            â”‚
â”‚        â€¢ Verify subscription status                        â”‚
â”‚                                                             â”‚
â”‚     3. Redeem coupon with QR code                          â”‚
â”‚        â€¢ Navigate to /kupon?id=...                        â”‚
â”‚        â€¢ Click scan button                                 â”‚
â”‚        â€¢ Grant camera permission                           â”‚
â”‚        â€¢ Verify redemption                                 â”‚
â”‚                                                             â”‚
â”‚     4. User authentication                                 â”‚
â”‚        â€¢ Sign up                                           â”‚
â”‚        â€¢ Log in                                            â”‚
â”‚        â€¢ Log out                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEVELOPER MACHINE                                          â”‚
â”‚                                                             â”‚
â”‚  git push origin main                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GITHUB REPOSITORY                                          â”‚
â”‚  â€¢ Source code                                             â”‚
â”‚  â€¢ Triggers webhook to Lovable                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOVABLE PLATFORM                                           â”‚
â”‚  â€¢ Automatic builds                                        â”‚
â”‚  â€¢ Vite production build                                   â”‚
â”‚  â€¢ Deploy to CDN                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRODUCTION (CDN)                                           â”‚
â”‚  â€¢ Static files: HTML, CSS, JS                            â”‚
â”‚  â€¢ Images, fonts, icons                                   â”‚
â”‚  â€¢ OneSignal service worker                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUPABASE PLATFORM (Always running)                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL Database                                 â”‚  â”‚
â”‚  â”‚  â€¢ Traffic reports                                   â”‚  â”‚
â”‚  â”‚  â€¢ Users, coupons, chat messages                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Edge Functions (auto-deploy from /supabase/functions)â”‚ â”‚
â”‚  â”‚  â€¢ submit-traffic-report                             â”‚  â”‚
â”‚  â”‚  â€¢ get-traffic-data                                  â”‚  â”‚
â”‚  â”‚  â€¢ send-push-notifications                           â”‚  â”‚
â”‚  â”‚  â€¢ etc.                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Legend

```
â”Œâ”€â”€â”€â”€â”€â”€â”   Single component/module
â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Container with multiple items
â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Item  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”‚  Data/control flow (downward)
    â–¼

    â—„â”€ Bi-directional flow

1:N    One-to-many relationship
PK     Primary Key
FK     Foreign Key
```

---

## Notes

These diagrams are simplified for clarity. Actual implementation includes:
- Error handling at every layer
- Loading states and optimistic updates
- Caching and cache invalidation strategies
- Rate limiting and throttling
- Security measures (CORS, authentication, input validation)
- Performance optimizations (code splitting, lazy loading)
